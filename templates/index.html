<!DOCTYPE html>
<html lang="fr">

<head>
    <meta http-equiv="refresh" content="30">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Triple A</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
</head>

<body>

    <div class="conteneur-page">

        <!-- En-tête -->
        <header class="boite-entete">
            <div class="infos-principales">
                <h1>{{name_machine}}</h1>
                <h3>Système d'exploitation : {{name_os}} {{name_systeme}}</h3>
                <h3>Adresse IP : {{ip_adress}}</h3>
            </div>

            <div class="infos-secondaires">
                Heure de démarrage : {{start_systeme}}<br>
                Temps depuis le démarrage : {{uptime_systeme}} heures<br>
                Nombre d'utilisateurs : {{name_user}}<br>
            </div>
        </header>

        <!-- Matériel -->
        <div class="materiel">

            <!-- Bloc CPU -->
            <div class="bloc-cpu">
                <h2>Processeur (CPU)</h2>
                <div class="contenu-cpu">
                    Nombre de cœurs : {{heart_cpu}}<br>
                    Fréquence (Hz) : {{freq_cpu}}<br><br>

                    <div class="jauge">
                        <div class="jauge-remplissage" id="cpu-fill"></div>
                        <div class="jauge-texte" id="cpu-text">{{percent_cpu}}</div>
                    </div>
                </div>
            </div>

            <!-- Bloc RAM -->
            <div class="bloc-ram">
                <h2>Mémoire vive (RAM)</h2>
                <div class="contenu-ram">
                    RAM utilisée : {{use_ram}} Go / {{full_ram}} Go<br><br>

                    <div class="jauge">
                        <div class="jauge-remplissage" id="ram-fill"></div>
                        <div class="jauge-texte" id="ram-text">{{percent_ram}}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Logiciels -->
    <div class="logiciels">

        <h2>Logiciels</h2>

        <!-- Liste complète des processus -->
        <div class="liste-processus">
            <h3>Liste des processus</h3>

            <div class="tableau-processus entete">
                <div class="colonne">Nom du processus (PID)</div>
                <div class="colonne2">CPU %</div>
                <div class="colonne2">RAM %</div>
            </div>

            {% for p in list_proc %}
            <div class="tableau-processus ligne">
                <div class="colonne">{{ p.name }} ({{ p.pid }})</div>
                <div class="colonne2">{{ "%.1f" | format(p.cpu_percent) }}</div>
                <div class="colonne2">{{ "%.1f" | format(p.memory_percent) }}</div>
            </div>
            {% endfor %}
        </div>

        <!-- Top 3 CPU -->
        <div class="top3">
            <h3>Top 3 des processus les plus gourmands (CPU)</h3>

            <div class="tableau-processus entete">
                <div class="colonne">Nom du processus (PID)</div>
                <div class="colonne2">CPU %</div>
                <div class="colonne2">RAM %</div>
            </div>

            {% for p in top_3 %}
            <div class="tableau-processus ligne surlignage">
                <div class="colonne">{{ p.name }} ({{ p.pid }})</div>
                <div class="colonne2">{{ "%.1f" | format(p.cpu_percent) }}</div>
                <div class="colonne2">{{ "%.1f" | format(p.memory_percent) }}</div>
            </div>
            {% endfor %}
        </div>

    </div>

    <!-- Script des jauges -->
    <script src="{{ url_for('static', filename='js/gauge.js') }}"></script>

    <script>
        updateGauge("cpu-fill", {{ percent_cpu }});
        updateGauge("ram-fill", {{ percent_ram }});

        function refreshGauges() {
            fetch("/api/stats")
                .then(r => r.json())
                .then(data => {
                    updateGauge("cpu-fill", "cpu-text", data.cpu);
                    updateGauge("ram-fill", "ram-text", data.ram);
                });
        }

        refreshGauges();
        setInterval(refreshGauges, 1000);
    </script>

</body>
</html>